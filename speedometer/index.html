<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Data</title>
    <style>
        body { 
            font-family: 'Lucida Console', 'Comic Sans MS', Arial, sans-serif; 
            text-align: center; 
            margin-top: 50px; 
            background: black;
            color:bisque;
        }
        .container { display: inline-block; text-align: left; }
    </style>
</head>
<body>
    <h1>Sensor Data</h1>
    <div class="container">
        <span id="speed">10.00</span>
    </div>
    <div class="container">
        <p><strong>Latitude:</strong> <span id="latitude">N/A</span></p>
        <p><strong>Longitude:</strong> <span id="longitude">N/A</span></p>
        <p><strong>Altitude:</strong> <span id="altitude">N/A</span></p>
        <p><strong>Speed:</strong> <span id="speed">N/A</span></p>
        <p><strong>Heading:</strong> <span id="heading">N/A</span></p>
        <p><strong>Acceleration X:</strong> <span id="accelX">N/A</span></p>
        <p><strong>Acceleration Y:</strong> <span id="accelY">N/A</span></p>
        <p><strong>Acceleration Z:</strong> <span id="accelZ">N/A</span></p>
    </div>

    <script>

let p0 = null;

function calculateVelocity(position) {
    let t1 = position.timestamp;
    let pc1 = position.coords;
    let velocity = 0;
    if (p0) {
        let t0 = p0.timestamp;
        let pc0 = p0.coords;
        let timeDiff = (t1 - t0) / 1000; // Convert milliseconds to seconds
        let distance = haversineDistance(pc0.latitude, pc0.longitude, pc1.latitude, pc1.longitude);
        velocity = timeDiff > 0 ? distance / timeDiff : 0; // meters per second
        console.log(`Velocity: ${velocity.toFixed(2)} m/s`);
    }
    p0 = position; // Store current position for next update
    return velocity;
}

function haversineDistance(lat1, lon1, lat2, lon2) {
    let R = 6371000; // Earth radius in meters
    let toRad = angle => (angle * Math.PI) / 180;

    let dLat = toRad(lat2 - lat1);
    let dLon = toRad(lon2 - lon1);
    let a = Math.sin(dLat / 2) ** 2 +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;
    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

    return R * c; // Distance in meters
}

//navigator.geolocation.watchPosition(calculateVelocity, console.error, { enableHighAccuracy: true });


function updateGPS() {
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
            p => {
                let speed = calculateVelocity(p);
                document.getElementById("latitude").textContent = p.coords.latitude.toFixed(6);
                document.getElementById("longitude").textContent = p.coords.longitude.toFixed(6);
                document.getElementById("altitude").textContent = p.coords.altitude ? p.coords.altitude.toFixed(2) : "N/A";
                document.getElementById("speed").textContent = speed.toFixed(2);
                document.getElementById("heading").textContent = p.coords.heading;
            },
            error => console.warn("GPS error: ", error),
            { enableHighAccuracy: true }
        );
    } else {
        console.warn("Geolocation is not supported.");
    }
}

function updateAccelerometer(event) {
    return;
    document.getElementById("accelX").textContent = event.accelerationIncludingGravity.x.toFixed(3);
    document.getElementById("accelY").textContent = event.accelerationIncludingGravity.y.toFixed(3);
    document.getElementById("accelZ").textContent = event.accelerationIncludingGravity.z.toFixed(3);
}

if ("DeviceMotionEvent" in window) {
    window.addEventListener("devicemotion", updateAccelerometer);
} else {
    console.warn("DeviceMotionEvent is not supported.");
}

setInterval(updateGPS, 1000);
</script>
</body>
</html>
